<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä¾‹ç®¡ç† - ç®¡ç†åå°</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="[[ url_for('static', filename='js/magic-experience.js')  ]]"></script>
    <link rel="stylesheet" href="[[ url_for('static', filename='css/admin-mobile.css')  ]]">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .stat-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .nav-item {
            transition: all 0.2s ease;
        }
        .nav-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        .nav-item.active {
            background: #3b82f6;
            color: white;
        }
        .case-card {
            transition: all 0.3s ease;
        }
        .case-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .filter-tab {
            transition: all 0.2s ease;
        }
        .filter-tab.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            transform: scale(1.05);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .baji-frame-admin {
            position: relative;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 20px rgba(59, 130, 246, 0.1),
                0 0 40px rgba(59, 130, 246, 0.05);
            overflow: hidden;
        }
        
        .baji-frame-admin::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: radial-gradient(
                circle at center,
                transparent 0%,
                transparent 70%,
                rgba(0, 0, 0, 0.1) 85%,
                rgba(0, 0, 0, 0.2) 100%
            );
            pointer-events: none;
            z-index: 1;
        }
        
        .case-image-admin {
            width: 140px !important;
            height: 140px !important;
            border-radius: 50%;
            object-fit: cover;
            transition: all 0.3s ease;
            position: relative;
            z-index: 0;
        }
        
        .case-card:hover .case-image-admin {
            transform: scale(1.05);
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .baji-frame-admin {
                width: 200px;
                height: 200px;
            }
            
            .case-image-admin {
                width: 180px !important;
                height: 180px !important;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen">
        <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="mobile-header">
            <h1>ğŸ ç®¡ç†åå°</h1>
            <button class="mobile-menu-btn" @click="toggleMobileMenu">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        
        <!-- ç§»åŠ¨ç«¯é®ç½©å±‚ -->
        <div class="mobile-overlay" :class="{ show: mobileMenuOpen }" @click="closeMobileMenu"></div>
        
        <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ  -->
        <div class="mobile-sidebar" :class="{ open: mobileMenuOpen }">
            <nav>
                <a href="/admin/dashboard" class="nav-item flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                    </svg>
                    ä»ªè¡¨ç›˜
                </a>
                <a href="/admin/orders" class="nav-item flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    è®¢å•ç®¡ç†
                </a>
                <a href="/admin/coupons" class="nav-item flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                    </svg>
                    åˆ¸ç ç®¡ç†
                </a>
                <a href="/admin/cases" class="nav-item active flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    æ¡ˆä¾‹ç®¡ç†
                </a>
                <a href="/admin/print" class="nav-item flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    æ‰“å°ç®¡ç†
                </a>
                <a href="/admin/delivery" class="nav-item flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    é…é€ç®¡ç†
                </a>
                <a href="/admin/devices" class="nav-item flex items-center px-4 py-3 rounded-lg">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    è®¾å¤‡ç®¡ç†
                </a>
                <div class="mt-8 pt-8 border-t border-gray-200">
                    <button @click="logout" class="w-full flex items-center px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        é€€å‡ºç™»å½•
                    </button>
                </div>
            </nav>
        </div>
        
        <!-- æ¡Œé¢ç‰ˆä¾§è¾¹æ  -->
        <div class="desktop-sidebar fixed inset-y-0 left-0 w-64 bg-white shadow-lg">
            <div class="p-6">
                <h1 class="text-xl font-bold text-gray-900 mb-8">ğŸ ç®¡ç†åå°</h1>
                
                <nav class="space-y-2">
                    <a href="/admin/dashboard" class="nav-item flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        </svg>
                        ä»ªè¡¨ç›˜
                    </a>
                    <a href="/admin/orders" class="nav-item flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        è®¢å•ç®¡ç†
                    </a>
                    <a href="/admin/coupons" class="nav-item flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                        </svg>
                        åˆ¸ç ç®¡ç†
                    </a>
                    <a href="/admin/cases" class="nav-item active flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        æ¡ˆä¾‹ç®¡ç†
                    </a>
                    <a href="/admin/print" class="nav-item flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                        </svg>
                        æ‰“å°ç®¡ç†
                    </a>
                    <a href="/admin/delivery" class="nav-item flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                        é…é€ç®¡ç†
                    </a>
                    <a href="/admin/devices" class="nav-item flex items-center px-4 py-3 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        è®¾å¤‡ç®¡ç†
                    </a>
                </nav>
                
                <div class="mt-8 pt-8 border-t border-gray-200">
                    <button @click="logout" class="w-full flex items-center px-4 py-3 text-red-600 hover:bg-red-50 rounded-lg">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        é€€å‡ºç™»å½•
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content ml-64 p-8">
            <div class="responsive-container">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">æ¡ˆä¾‹ç®¡ç†</h2>
                    <div class="flex space-x-4">
                        <button @click="showCreateModal = true" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            åˆ›å»ºæ¡ˆä¾‹
                        </button>
                        <button @click="showBatchModal = true" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            æ‰¹é‡æ“ä½œ
                        </button>
                    </div>
                </div>

                <!-- ç­›é€‰å™¨ -->
                <div class="stat-card p-6 mb-6">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="flex space-x-2">
                            <button v-for="filter in filters" :key="filter.value"
                                :class="['filter-tab px-4 py-2 rounded-lg font-medium', { active: currentFilter === filter.value }]"
                                @click="setFilter(filter.value)"
                                class="bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-blue-600">
                                <span v-text="filter.label"></span>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æœç´¢æ¡ˆä¾‹</label>
                            <input type="text" v-model="searchQuery" @input="searchCases" placeholder="æœç´¢æ¡ˆä¾‹..."
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†ç±»ç­›é€‰</label>
                            <select v-model="categoryFilter" @change="loadCases" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option v-for="category in categories" :key="category" :value="category">
                                    <span v-text="category"></span>
                                </option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹ç±»å‹</label>
                            <select v-model="caseTypeFilter" @change="loadCases" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">å…¨éƒ¨ç±»å‹</option>
                                <option value="official">å®˜æ–¹æ¡ˆä¾‹</option>
                                <option value="user">ç”¨æˆ·æ¡ˆä¾‹</option>
                                <option value="draft">è‰ç¨¿æ¡ˆä¾‹</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="stat-card p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">æ€»æ¡ˆä¾‹æ•°</p>
                                <p class="text-2xl font-bold text-gray-900" v-text="stats.total || 0"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-lg">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">æ¨èæ¡ˆä¾‹</p>
                                <p class="text-2xl font-bold text-gray-900" v-text="stats.featured || 0"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">å…¬å¼€æ¡ˆä¾‹</p>
                                <p class="text-2xl font-bold text-gray-900" v-text="stats.public || 0"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-orange-100 rounded-lg">
                                <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a2 2 0 00-2-2H8a2 2 0 00-2 2v2h12z"></path>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">ç§æœ‰æ¡ˆä¾‹</p>
                                <p class="text-2xl font-bold text-gray-900" v-text="stats.private || 0"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ¡ˆä¾‹åˆ—è¡¨ -->
                <div class="stat-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex space-x-4">
                            <button @click="selectAll" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                å…¨é€‰
                            </button>
                            <button @click="batchDelete" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                                æ‰¹é‡åˆ é™¤
                            </button>
                        </div>
                        <div class="text-sm text-gray-600">
                            å…± <span v-text="totalCount"></span> ä¸ªæ¡ˆä¾‹
                        </div>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div v-if="loading" class="text-center py-12">
                        <div class="loading-spinner w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full mx-auto mb-4"></div>
                        <p class="text-gray-600">åŠ è½½ä¸­...</p>
                    </div>

                    <!-- æ¡ˆä¾‹ç½‘æ ¼ -->
                    <div v-else-if="cases.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <div v-for="caseData in cases" :key="caseData.id" class="case-card bg-white rounded-xl shadow-sm hover:shadow-xl overflow-hidden border border-gray-200">
                            <!-- æ¡ˆä¾‹å›¾ç‰‡ -->
                            <div class="case-image-container relative overflow-hidden rounded-t-xl flex justify-center items-center" style="aspect-ratio: 1;">
                                <div class="baji-frame-admin">
                                    <img :src="getImageUrl(caseData.preview_image_path)" :alt="caseData.title" class="case-image-admin">
                                </div>
                                
                                <!-- æ¡ˆä¾‹æ ‡ç­¾ -->
                                <div class="case-badges absolute top-3 left-3 flex flex-col gap-2">
                                    <span v-if="caseData.is_featured" class="badge badge-featured px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-600">
                                        â­ æ¨è
                                    </span>
                                    <span v-if="!caseData.is_public" class="badge badge-private px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-600">
                                        ğŸ”’ ç§æœ‰
                                    </span>
                                </div>

                                <!-- é€‰æ‹©æ¡† -->
                                <div class="absolute top-3 right-3">
                                    <input type="checkbox" :value="caseData.id" v-model="selectedCases" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                </div>
                            </div>

                            <!-- æ¡ˆä¾‹ä¿¡æ¯ -->
                            <div class="case-info p-4">
                                <h3 class="case-title text-lg font-semibold text-gray-800 mb-2" v-text="caseData.title"></h3>
                                <p class="case-description text-sm text-gray-600 mb-3" v-text="caseData.description"></p>

                                <div class="case-meta">
                                    <div class="case-tags flex flex-wrap gap-2 mb-3">
                                        <span v-for="tag in caseData.tags" :key="tag" class="tag px-2 py-1 rounded-full bg-blue-100 text-blue-600 text-xs">
                                            <span v-text="tag"></span>
                                        </span>
                                    </div>

                                    <div class="case-stats flex justify-between items-center text-sm text-gray-500 mb-3">
                                        <span class="stat flex items-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                            </svg>
                                            <span v-text="caseData.view_count || 0"></span>
                                        </span>
                                        <span class="stat flex items-center space-x-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                            </svg>
                                            <span v-text="caseData.like_count || 0"></span>
                                        </span>
                                    </div>

                                    <!-- æ“ä½œæŒ‰é’® -->
                                    <div class="case-actions flex space-x-2">
                                        <button @click="editCase(caseData)" class="btn btn-sm btn-primary flex-1 px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors">
                                            ç¼–è¾‘
                                        </button>
                                        <button @click="deleteCase(caseData.id)" class="btn btn-sm btn-secondary px-3 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition-colors">
                                            åˆ é™¤
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç©ºçŠ¶æ€ -->
                    <div v-else class="text-center py-12">
                        <div class="empty-icon mb-4">
                            <svg class="w-16 h-16 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">æš‚æ— æ¡ˆä¾‹</h3>
                        <p class="text-gray-600 mb-6">è¿˜æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¡ˆä¾‹</p>
                    </div>

                    <!-- åˆ†é¡µ -->
                    <div v-if="totalPages > 1" class="mt-8 text-center">
                        <div class="flex justify-center space-x-2">
                            <button v-for="page in visiblePages" :key="page"
                                :class="['px-4 py-2 rounded-lg font-medium', { 'bg-blue-600 text-white': page === currentPage, 'bg-gray-100 text-gray-600 hover:bg-gray-200': page !== currentPage }]"
                                @click="goToPage(page)">
                                <span v-text="page"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ›å»ºæ¡ˆä¾‹æ¨¡æ€æ¡† -->
        <div v-if="showCreateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="closeCreateModal">
            <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4" @click.stop>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">åˆ›å»ºæ¡ˆä¾‹</h3>

                <form @submit.prevent="createCase">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹æ ‡é¢˜</label>
                            <input type="text" v-model="newCase.title" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹æè¿°</label>
                            <textarea v-model="newCase.description" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†ç±»</label>
                                <select v-model="newCase.category" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="å®˜æ–¹è®¾è®¡">å®˜æ–¹è®¾è®¡</option>
                                    <option value="ç”¨æˆ·åˆ›ä½œ">ç”¨æˆ·åˆ›ä½œ</option>
                                    <option value="åŠ¨æ¼«">åŠ¨æ¼«</option>
                                    <option value="æ¸¸æˆ">æ¸¸æˆ</option>
                                    <option value="åŸåˆ›">åŸåˆ›</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹ç±»å‹</label>
                                <select v-model="newCase.case_type" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="official">å®˜æ–¹æ¡ˆä¾‹</option>
                                    <option value="user">ç”¨æˆ·æ¡ˆä¾‹</option>
                                    <option value="draft">è‰ç¨¿æ¡ˆä¾‹</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ ‡ç­¾</label>
                            <input type="text" v-model="newCase.tagsInput" placeholder="ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ‡ç­¾" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- å›¾ç‰‡ä¸Šä¼  -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹å›¾ç‰‡</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors">
                                <input type="file" ref="imageInput" @change="handleImageUpload" accept="image/*" class="hidden">
                                <div v-if="!newCase.uploadedImage" @click="$refs.imageInput.click()" class="cursor-pointer">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-gray-600">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</p>
                                    <p class="text-sm text-gray-500 mt-1">æ”¯æŒ JPGã€PNG æ ¼å¼</p>
                                </div>
                                <div v-else class="space-y-4">
                                    <div class="flex justify-center">
                                        <div class="baji-frame-admin">
                                            <img :src="newCase.uploadedImage.preview" alt="é¢„è§ˆå›¾ç‰‡" class="case-image-admin">
                                        </div>
                                    </div>
                                    <div class="flex justify-center space-x-2">
                                        <button type="button" @click="removeImage" class="px-3 py-1 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors">
                                            åˆ é™¤
                                        </button>
                                        <button type="button" @click="$refs.imageInput.click()" class="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors">
                                            é‡æ–°é€‰æ‹©
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="checkbox" v-model="newCase.is_featured" class="mr-2">
                                <span class="text-sm text-gray-700">è®¾ä¸ºæ¨èæ¡ˆä¾‹</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" v-model="newCase.is_public" class="mr-2">
                                <span class="text-sm text-gray-700">å…¬å¼€æ˜¾ç¤º</span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-4 mt-6">
                        <button type="button" class="px-6 py-2 rounded-lg bg-gray-300 text-gray-700 hover:bg-gray-400 transition-colors" @click="closeCreateModal">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors">
                            åˆ›å»º
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- æ‰¹é‡æ“ä½œæ¨¡æ€æ¡† -->
        <div v-if="showBatchModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="closeBatchModal">
            <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4" @click.stop>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">æ‰¹é‡æ“ä½œ</h3>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©æ“ä½œ</label>
                        <select v-model="batchAction" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">è¯·é€‰æ‹©æ“ä½œ</option>
                            <option value="feature">è®¾ä¸ºæ¨è</option>
                            <option value="unfeature">å–æ¶ˆæ¨è</option>
                            <option value="publish">å…¬å¼€æ˜¾ç¤º</option>
                            <option value="unpublish">è®¾ä¸ºç§æœ‰</option>
                            <option value="delete">åˆ é™¤æ¡ˆä¾‹</option>
                        </select>
                    </div>

                    <div class="text-sm text-gray-600">
                        å·²é€‰æ‹© <span v-text="selectedCases.length"></span> ä¸ªæ¡ˆä¾‹
                    </div>
                </div>

                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" class="px-6 py-2 rounded-lg bg-gray-300 text-gray-700 hover:bg-gray-400 transition-colors" @click="closeBatchModal">
                        å–æ¶ˆ
                    </button>
                    <button type="button" class="px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors" @click="executeBatchAction" :disabled="!batchAction || selectedCases.length === 0">
                        æ‰§è¡Œ
                    </button>
                </div>
            </div>
        </div>

        <!-- ç¼–è¾‘æ¡ˆä¾‹æ¨¡æ€æ¡† -->
        <div v-if="showEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click="closeEditModal">
            <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto" @click.stop>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">ç¼–è¾‘æ¡ˆä¾‹</h3>

                <form @submit.prevent="saveCaseEdit">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹æ ‡é¢˜</label>
                            <input type="text" v-model="editingCase.title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹æè¿°</label>
                            <textarea v-model="editingCase.description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†ç±»</label>
                                <select v-model="editingCase.category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="å®˜æ–¹è®¾è®¡">å®˜æ–¹è®¾è®¡</option>
                                    <option value="ç”¨æˆ·ä½œå“">ç”¨æˆ·ä½œå“</option>
                                    <option value="èŠ‚æ—¥ä¸»é¢˜">èŠ‚æ—¥ä¸»é¢˜</option>
                                    <option value="åŠ¨æ¼«è§’è‰²">åŠ¨æ¼«è§’è‰²</option>
                                    <option value="æ¸¸æˆè§’è‰²">æ¸¸æˆè§’è‰²</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æ¡ˆä¾‹ç±»å‹</label>
                                <select v-model="editingCase.case_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="official">å®˜æ–¹</option>
                                    <option value="user">ç”¨æˆ·</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æ ‡ç­¾ (ç”¨é€—å·åˆ†éš”)</label>
                            <input type="text" v-model="editingCase.tagsInput" placeholder="ä¾‹å¦‚: å¯çˆ±, åŠ¨æ¼«, ç²‰è‰²" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="checkbox" v-model="editingCase.is_featured" class="mr-2">
                                <span class="text-sm text-gray-700">è®¾ä¸ºæ¨èæ¡ˆä¾‹</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" v-model="editingCase.is_public" class="mr-2">
                                <span class="text-sm text-gray-700">å…¬å¼€æ˜¾ç¤º</span>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" @click="closeEditModal" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            ä¿å­˜
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, computed } = Vue;

        createApp({ 
            setup() {
                const cases = ref([]);
                const stats = ref({
                    total: 0,
                    featured: 0,
                    public: 0,
                    private: 0
                });
                const categories = ref([]);
                const loading = ref(false);
                const currentFilter = ref('all');
                const searchQuery = ref('');
                const categoryFilter = ref('');
                const caseTypeFilter = ref('');
                const selectedCases = ref([]);
                const currentPage = ref(1);
                const totalPages = ref(1);
                const totalCount = ref(0);
                const showCreateModal = ref(false);
                const showEditModal = ref(false);
                const editingCase = ref({});
                const showBatchModal = ref(false);
                const batchAction = ref('');
                const newCase = ref({
                    title: '',
                    description: '',
                    category: 'å®˜æ–¹è®¾è®¡',
                    case_type: 'official',
                    tagsInput: '',
                    is_featured: false,
                    is_public: true,
                    uploadedImage: null
                });
                const filters = ref([
                    { value: 'all', label: 'å…¨éƒ¨' },
                    { value: 'featured', label: 'æ¨è' },
                    { value: 'public', label: 'å…¬å¼€' },
                    { value: 'private', label: 'ç§æœ‰' }
                ]);
                const mobileMenuOpen = ref(false);

                const visiblePages = computed(() => {
                    const pages = [];
                    const start = Math.max(1, currentPage.value - 2);
                    const end = Math.min(totalPages.value, currentPage.value + 2);

                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }

                    return pages;
                });

                const loadCases = async () => {
                    loading.value = true;
                    try {
                        const params = new URLSearchParams({
                            page: currentPage.value,
                            per_page: 12
                        });

                        if (currentFilter.value !== 'all') {
                            params.append('status', currentFilter.value);
                        }

                        if (categoryFilter.value) {
                            params.append('category', categoryFilter.value);
                        }

                        if (caseTypeFilter.value) {
                            params.append('type', caseTypeFilter.value);
                        }

                        if (searchQuery.value) {
                            params.append('search', searchQuery.value);
                        }

                        const response = await fetch(`/api/v1/admin/cases?${params}`);
                        const data = await response.json();

                        if (data.cases) {
                            cases.value = data.cases;
                            totalPages.value = data.pages;
                            totalCount.value = data.total;
                        } else {
                            // æ¨¡æ‹Ÿæ•°æ®
                            cases.value = [
                                {
                                    id: 1,
                                    title: 'æµ‹è¯•æ¡ˆä¾‹',
                                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹',
                                    category: 'å®˜æ–¹è®¾è®¡',
                                    case_type: 'official',
                                    tags: ['æµ‹è¯•', 'æ¡ˆä¾‹'],
                                    is_featured: true,
                                    is_public: true,
                                    preview_image_path: '/static/images/placeholder.png',
                                    view_count: 100,
                                    like_count: 25
                                }
                            ];
                            totalPages.value = 1;
                            totalCount.value = 1;
                        }
                    } catch (error) {
                        console.error('åŠ è½½æ¡ˆä¾‹å¤±è´¥:', error);
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('åŠ è½½æ¡ˆä¾‹å¤±è´¥', 'error', 3000);
                        }
                    } finally {
                        loading.value = false;
                    }
                };

                const loadStats = async () => {
                    try {
                        const response = await fetch('/api/v1/admin/cases/stats');
                        const data = await response.json();

                        if (data.total !== undefined) {
                            stats.value = data;
                        } else {
                            // æ¨¡æ‹Ÿæ•°æ®
                            stats.value = {
                                total: 1,
                                featured: 1,
                                public: 1,
                                private: 0
                            };
                        }
                    } catch (error) {
                        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error);
                        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                        stats.value = {
                            total: 1,
                            featured: 1,
                            public: 1,
                            private: 0
                        };
                    }
                };

                const loadCategories = async () => {
                    try {
                        const response = await fetch('/api/v1/admin/cases/stats');
                        const data = await response.json();

                        if (data.by_category) {
                            categories.value = Object.keys(data.by_category);
                        } else {
                            // æ¨¡æ‹Ÿæ•°æ®
                            categories.value = ['å®˜æ–¹è®¾è®¡', 'ç”¨æˆ·åˆ›ä½œ', 'åŠ¨æ¼«', 'æ¸¸æˆ', 'åŸåˆ›'];
                        }
                    } catch (error) {
                        console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
                        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                        categories.value = ['å®˜æ–¹è®¾è®¡', 'ç”¨æˆ·åˆ›ä½œ', 'åŠ¨æ¼«', 'æ¸¸æˆ', 'åŸåˆ›'];
                    }
                };

                const logout = async () => {
                    try {
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('æ­£åœ¨é€€å‡º...', 'info', 1000);
                        }
                        
                        await fetch('/api/v1/admin/logout', { method: 'POST' });
                        
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('é€€å‡ºæˆåŠŸï¼', 'success', 1000);
                        }
                        
                        setTimeout(() => {
                            window.location.href = '/admin/login';
                        }, 1000);
                    } catch (error) {
                        console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('é€€å‡ºå¤±è´¥', 'error', 3000);
                        }
                    }
                };

                const toggleMobileMenu = () => {
                    mobileMenuOpen.value = !mobileMenuOpen.value;
                };

                const closeMobileMenu = () => {
                    mobileMenuOpen.value = false;
                };

                const setFilter = (filter) => {
                    currentFilter.value = filter;
                    currentPage.value = 1;
                    loadCases();
                };

                const searchCases = () => {
                    currentPage.value = 1;
                    loadCases();
                };

                const goToPage = (page) => {
                    currentPage.value = page;
                    loadCases();
                };

                const selectAll = () => {
                    if (selectedCases.value.length === cases.value.length) {
                        selectedCases.value = [];
                    } else {
                        selectedCases.value = cases.value.map(caseData => caseData.id);
                    }
                };

                const handleImageUpload = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    // éªŒè¯æ–‡ä»¶ç±»å‹
                    if (!file.type.startsWith('image/')) {
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error', 2000);
                        }
                        return;
                    }

                    // éªŒè¯æ–‡ä»¶å¤§å° (5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB', 'error', 2000);
                        }
                        return;
                    }

                    // åˆ›å»ºé¢„è§ˆ
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newCase.value.uploadedImage = {
                            file: file,
                            preview: e.target.result
                        };
                    };
                    reader.readAsDataURL(file);
                };

                const removeImage = () => {
                    newCase.value.uploadedImage = null;
                };

                const createCase = async () => {
                    try {
                        // å¦‚æœæ²¡æœ‰ä¸Šä¼ å›¾ç‰‡ï¼Œä½¿ç”¨é»˜è®¤å›¾ç‰‡
                        let originalImagePath = '/static/images/placeholder.png';
                        let previewImagePath = '/static/images/placeholder.png';

                        // å¦‚æœæœ‰ä¸Šä¼ å›¾ç‰‡ï¼Œå…ˆä¸Šä¼ å›¾ç‰‡
                        if (newCase.value.uploadedImage) {
                            const formData = new FormData();
                            formData.append('file', newCase.value.uploadedImage.file);

                            const uploadResponse = await fetch('/api/v1/upload', {
                                method: 'POST',
                                body: formData
                            });

                            const uploadData = await uploadResponse.json();
                            if (uploadData.success) {
                                originalImagePath = uploadData.file_path;
                                previewImagePath = uploadData.file_path;
                            } else {
                                if (window.MagicExperience) {
                                    window.MagicExperience.showMagicNotification('å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ' + uploadData.error, 'error', 3000);
                                }
                                return;
                            }
                        }

                        const caseData = {
                            ...newCase.value,
                            tags: newCase.value.tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag),
                            original_image_path: originalImagePath,
                            preview_image_path: previewImagePath
                        };

                        // ç§»é™¤uploadedImageå­—æ®µï¼Œä¸å‘é€åˆ°æœåŠ¡å™¨
                        delete caseData.uploadedImage;

                        const response = await fetch('/api/v1/admin/cases/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(caseData)
                        });

                        const data = await response.json();

                        if (data.success) {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification('æ¡ˆä¾‹åˆ›å»ºæˆåŠŸï¼', 'success', 2000);
                            }
                            closeCreateModal();
                            loadCases();
                            loadStats();
                        } else {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification(data.error || 'åˆ›å»ºå¤±è´¥', 'error', 3000);
                            }
                        }
                    } catch (error) {
                        console.error('åˆ›å»ºæ¡ˆä¾‹å¤±è´¥:', error);
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('åˆ›å»ºæ¡ˆä¾‹å¤±è´¥', 'error', 3000);
                        }
                    }
                };

                const editCase = (caseData) => {
                    editingCase.value = { 
                        ...caseData,
                        tagsInput: caseData.tags ? caseData.tags.join(', ') : ''
                    };
                    showEditModal.value = true;
                };

                const saveCaseEdit = async () => {
                    try {
                        const caseData = {
                            title: editingCase.value.title,
                            description: editingCase.value.description,
                            category: editingCase.value.category,
                            case_type: editingCase.value.case_type,
                            tags: editingCase.value.tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag),
                            is_featured: editingCase.value.is_featured,
                            is_public: editingCase.value.is_public
                        };

                        const response = await fetch(`/api/v1/admin/cases/${editingCase.value.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(caseData)
                        });

                        const data = await response.json();

                        if (data.success) {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification('æ¡ˆä¾‹æ›´æ–°æˆåŠŸï¼', 'success', 2000);
                            }
                            closeEditModal();
                            loadCases();
                            loadStats();
                        } else {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification(data.error || 'æ›´æ–°å¤±è´¥', 'error', 3000);
                            }
                        }
                    } catch (error) {
                        console.error('æ›´æ–°æ¡ˆä¾‹å¤±è´¥:', error);
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('æ›´æ–°æ¡ˆä¾‹å¤±è´¥', 'error', 3000);
                        }
                    }
                };

                const closeEditModal = () => {
                    showEditModal.value = false;
                    editingCase.value = {};
                };

                const deleteCase = async (caseId) => {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¡ˆä¾‹å—ï¼Ÿ')) {
                        return;
                    }

                    try {
                        const response = await fetch(`/api/v1/admin/cases/${caseId}`, {
                            method: 'DELETE'
                        });

                        const data = await response.json();

                        if (data.success) {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification('æ¡ˆä¾‹åˆ é™¤æˆåŠŸ', 'success', 2000);
                            }
                            loadCases();
                            loadStats();
                        } else {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification(data.error || 'åˆ é™¤å¤±è´¥', 'error', 3000);
                            }
                        }
                    } catch (error) {
                        console.error('åˆ é™¤æ¡ˆä¾‹å¤±è´¥:', error);
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('åˆ é™¤æ¡ˆä¾‹å¤±è´¥', 'error', 3000);
                        }
                    }
                };

                const batchDelete = () => {
                    if (selectedCases.value.length === 0) {
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ¡ˆä¾‹', 'warning', 2000);
                        }
                        return;
                    }

                    if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedCases.value.length} ä¸ªæ¡ˆä¾‹å—ï¼Ÿ`)) {
                        return;
                    }

                    if (window.MagicExperience) {
                        window.MagicExperience.showMagicNotification('æ‰¹é‡åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...', 'info', 2000);
                    }
                };

                const executeBatchAction = async () => {
                    if (!batchAction.value || selectedCases.value.length === 0) {
                        return;
                    }

                    try {
                        const response = await fetch('/api/v1/admin/cases/batch', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                action: batchAction.value,
                                case_ids: selectedCases.value
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification(`æ‰¹é‡æ“ä½œæˆåŠŸï¼Œå½±å“äº† ${data.affected_count} ä¸ªæ¡ˆä¾‹`, 'success', 2000);
                            }
                            closeBatchModal();
                            selectedCases.value = [];
                            batchAction.value = '';
                            loadCases();
                            loadStats();
                        } else {
                            if (window.MagicExperience) {
                                window.MagicExperience.showMagicNotification(data.error || 'æ‰¹é‡æ“ä½œå¤±è´¥', 'error', 3000);
                            }
                        }
                    } catch (error) {
                        console.error('æ‰¹é‡æ“ä½œå¤±è´¥:', error);
                        if (window.MagicExperience) {
                            window.MagicExperience.showMagicNotification('æ‰¹é‡æ“ä½œå¤±è´¥', 'error', 3000);
                        }
                    }
                };

                const closeCreateModal = () => {
                    showCreateModal.value = false;
                    newCase.value = {
                        title: '',
                        description: '',
                        category: 'å®˜æ–¹è®¾è®¡',
                        case_type: 'official',
                        tagsInput: '',
                        is_featured: false,
                        is_public: true,
                        uploadedImage: null
                    };
                };

                const closeBatchModal = () => {
                    showBatchModal.value = false;
                    batchAction.value = '';
                };

                const getImageUrl = (imagePath) => {
                    if (!imagePath) return '/static/images/placeholder.png';
                    
                    // å¦‚æœæ˜¯å®Œæ•´URLï¼Œç›´æ¥è¿”å›
                    if (imagePath.startsWith('http')) {
                        return imagePath;
                    }
                    
                    // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå¤„ç†è·¯å¾„åˆ†éš”ç¬¦
                    let normalizedPath = imagePath.replace(/\\/g, '/');
                    
                    // å¦‚æœè·¯å¾„ä»¥static/uploadså¼€å¤´ï¼Œæå–æ–‡ä»¶å
                    if (normalizedPath.includes('static/uploads/')) {
                        const filename = normalizedPath.split('/').pop();
                        return `/api/v1/image/${filename}`;
                    }
                    
                    // å¦‚æœè·¯å¾„åŒ…å«uploadsï¼Œæå–æ–‡ä»¶å
                    if (normalizedPath.includes('uploads/')) {
                        const filename = normalizedPath.split('/').pop();
                        return `/api/v1/image/${filename}`;
                    }
                    
                    // å¦‚æœåªæ˜¯æ–‡ä»¶åï¼Œç›´æ¥ä½¿ç”¨
                    if (!normalizedPath.includes('/')) {
                        return `/api/v1/image/${normalizedPath}`;
                    }
                    
                    // å…¶ä»–æƒ…å†µï¼Œå°è¯•æå–æ–‡ä»¶å
                    const filename = normalizedPath.split('/').pop();
                    return `/api/v1/image/${filename}`;
                };

                onMounted(() => {
                    // åˆå§‹åŒ–Magic Experienceç³»ç»Ÿ
                    if (window.MagicExperience) {
                        window.MagicExperience.init();
                        
                        // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ é­”æ³•æ•ˆæœ
                        document.querySelectorAll('button').forEach(button => {
                            window.MagicExperience.addMagicButtonEffect(button);
                        });
                        
                        // ä¸ºæ‰€æœ‰å¡ç‰‡æ·»åŠ é­”æ³•æ•ˆæœ
                        document.querySelectorAll('.stat-card, .case-card').forEach(card => {
                            window.MagicExperience.addMagicCardEffect(card);
                        });
                        
                        // æ˜¾ç¤ºæ¬¢è¿é€šçŸ¥
                        window.MagicExperience.showMagicNotification('æ¬¢è¿æ¥åˆ°æ¡ˆä¾‹ç®¡ç†ï¼', 'success', 3000);
                    }
                    
                    loadCases();
                    loadStats();
                    loadCategories();
                });

                return {
                    cases,
                    stats,
                    categories,
                    loading,
                    currentFilter,
                    searchQuery,
                    categoryFilter,
                    caseTypeFilter,
                    selectedCases,
                    currentPage,
                    totalPages,
                    totalCount,
                    showCreateModal,
                    showEditModal,
                    editingCase,
                    showBatchModal,
                    batchAction,
                    newCase,
                    filters,
                    mobileMenuOpen,
                    visiblePages,
                    loadCases,
                    loadStats,
                    loadCategories,
                    logout,
                    toggleMobileMenu,
                    closeMobileMenu,
                    setFilter,
                    searchCases,
                    goToPage,
                    selectAll,
                    handleImageUpload,
                    removeImage,
                    createCase,
                    editCase,
                    saveCaseEdit,
                    closeEditModal,
                    deleteCase,
                    batchDelete,
                    executeBatchAction,
                    closeCreateModal,
                    closeBatchModal,
                    getImageUrl
                };
            }
        }).mount('#app');
    </script>
</body>
</html>